<!doctype html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VV5DY5JBSZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-VV5DY5JBSZ');
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Penncamm</title>
  <link rel="icon" type="image/png" href="favicon96.png" id="i5zs8q" />
  <meta name="description" content="Penncamm - Don't just capture content, capture memories" />

  <link rel="stylesheet" href="index.css" />
</head>
<body>
  <!-- Header -->
  <header id="site-header" class="site-header">
    <div class="left">
      <div class="brand">Penncamm</div>
    </div>
    <nav class="nav" id="site-nav">
      <a class="nav-link" href="#home" data-target="home">Home</a>
      <a class="nav-link" href="#gallery" data-target="gallery">Samples</a>
      <a class="nav-link" href="#features" data-target="features">Features</a>
      <a class="nav-link" href="#about" data-target="about">About</a>
      <a class="nav-link" href="#buy" data-target="buy">Estimate</a>
      <a class="nav-link" href="#legal" data-target="legal">Legal</a>
    </nav>
    <div class="right">
      <img src="favicon96.png" alt="Penncamm logo" class="logo" />
      <a class="webring-button" href="https://www.pennbrenn.com" target="_blank" rel="noopener">Pennbrenn</a>
    </div>
  </header>

  <!-- Animated background layer -->
  <div id="bg-anim" class="bg-anim" aria-hidden="true"></div>

  <main>
    <!-- Home / hero - fullscreen -->
    <section id="home" class="panel hero">
      <div class="glass">
        <h1 class="title">Penncamm</h1>
        <img src="penncammcam.png" alt="Penncamm camera" class="hero-cam" />
        <p class="lead">Don't just capture content, capture memories.</p>
      </div>
    </section>

    <!-- Samples -->
    <section id="gallery" class="panel">
      <div class="glass">
        <h2 class="section-title">Sample photos — lenses</h2>
        <p class="section-sub">Photos taken with each lens: standard, fisheye, macro, zoom.</p>

        <div class="samples-grid">
          <figure><img src="sam.png" alt="standard sample" /><figcaption>Standard</figcaption></figure>
          <figure><img src="sam.png" alt="fisheye sample" /><figcaption>Fisheye</figcaption></figure>
          <figure><img src="sam.png" alt="macro sample" /><figcaption>Macro</figcaption></figure>
          <figure><img src="sam.png" alt="zoom sample" /><figcaption>Zoom</figcaption></figure>
        </div>
      </div>
    </section>

    <!-- Features -->
    <section id="features" class="panel">
      <div class="glass">
        <h2 class="section-title">Features</h2>
        <div class="feature-grid">
          <div class="feature">
            <h3>Build & Durability</h3>
            <p>A stainless steel or reinforced plastic frame ensures durability in every moment.</p>
          </div>
          <div class="feature">
            <h3>Display</h3>
            <p>A high-definition display lets you see your memories as they were meant to be seen.</p>
          </div>
          <div class="feature">
            <h3>Ergonomics</h3>
            <p>Textured, non-slip leather or foam grip for secure, comfortable handling.</p>
          </div>
          <div class="feature">
            <h3>Repairability</h3>
            <p>With a lifetime warranty (limited — see legal) you can be reassured you'll have every moment.</p>
          </div>

          <div class="feature">
            <h3>Technology / Sensor</h3>
            <p>An 8MP sensor with 1080p video captures vivid detail.</p>
          </div>
          <div class="feature">
            <h3>Battery</h3>
            <p>Up to a 2000mAh battery for extended shooting time.</p>
          </div>
          <div class="feature">
            <h3>Interface</h3>
            <p>Minimal controls so capturing memories becomes second nature.</p>
          </div>
          <div class="feature">
            <h3>Flash</h3>
            <p>Strong flash with auto exposure to light every moment properly.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- About -->
    <section id="about" class="panel">
      <div class="glass">
        <h2 class="section-title">About</h2>
        <p class="section-sub">Basic about me — (you can edit later).</p>
        <p class="para">Handmade digital cameras crafted to last. We design every camera with repairability and longevity in mind.</p>
        <a class="btn" href="https://www.pennbrenn.com" target="_blank" rel="noopener">Learn more at pennbrenn.com</a>
      </div>
    </section>

    <!-- Buy / Estimate generator -->
    <section id="buy" class="panel">
      <div class="glass">
        <h2 class="section-title">Estimate / Quote</h2>
        <p class="section-sub">Select options below to build a custom estimate. This creates a copyable email to send to <strong>cam@pennbrenn.com</strong>.</p>

        <div id="estimate-app" class="estimate-app">
          <div class="left-col">
            <div id="options-container" class="options-container">
              <!-- options loaded from options.json -->
              <p class="muted">Loading options…</p>
            </div>
          </div>

          <div class="right-col">
            <div class="summary glass-small">
              <h3>Summary</h3>
              <div id="summary-list" class="summary-list">No options selected.</div>
              <div class="summary-row"><span>Parts</span><span id="parts-cost">$15.00</span></div>
              <div class="summary-row"><span>Labor</span><span id="labor-cost">$40.00</span></div>
              <div class="summary-row total"><span>Total</span><span id="total-cost">$0.00</span></div>
              <p class="muted small">Lead time up to a month.</p>
            </div>

            <div class="email-builder glass-small">
              <h3>Email preview</h3>
              <label for="to-email">To</label>
              <input id="to-email" value="cam@pennbrenn.com" />

              <label for="from-email">Your email</label>
              <input id="from-email" placeholder="you@example.com" />

              <label for="from-phone">Phone (optional)</label>
              <input id="from-phone" placeholder="(555) 555-5555" />

              <label for="extra-notes">Questions / notes</label>
              <textarea id="extra-notes" placeholder="Any preferences, questions, or special requests"></textarea>

              <label for="email-preview">Preview</label>
              <textarea id="email-preview" readonly rows="8"></textarea>

              <div class="actions">
                <button id="copy-email" class="btn">Copy email</button>
                <button id="open-mail" class="btn outline">Open in mail</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Legal -->
    <section id="legal" class="panel">
      <div class="glass">
        <h2 class="section-title">Legal</h2>
        <p class="para">Warranty and legal details are available on the dedicated legal page.</p>
        <a class="btn" href="./legal.html">Open legal</a>
      </div>
    </section>

    <footer class="footer">
      <div>© Penncamm • Handmade cameras • <a href="./legal.html">Legal</a></div>
    </footer>
  </main>

  <!-- Inline JS (keeps files as requested) -->
  <script>
    // --- Utilities ---
    function money(n){ return '$' + (Number(n) || 0).toFixed(2); }

    // IntersectionObserver for header nav highlight
    (() => {
      const navLinks = document.querySelectorAll('.nav-link');
      const sections = Array.from(navLinks).map(a => document.getElementById(a.dataset.target));
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          const id = entry.target.id;
          const link = document.querySelector('.nav-link[data-target="' + id + '"]');
          if(entry.isIntersecting){
            navLinks.forEach(l=> l.classList.remove('active'));
            if(link) link.classList.add('active');
          }
        });
      }, { threshold: 0.5 });
      sections.forEach(s => s && observer.observe(s));
    })();

    // Smooth scroll behavior for nav links
    document.querySelectorAll('.nav-link').forEach(a => {
      a.addEventListener('click', e => {
        e.preventDefault();
        const t = document.getElementById(a.dataset.target);
        t && t.scrollIntoView({behavior:'smooth', block:'start'});
      });
    });

    // Sticky header subtle shadow on scroll
    const header = document.getElementById('site-header');
    window.addEventListener('scroll', () => {
      if(window.scrollY > 20) header.classList.add('scrolled');
      else header.classList.remove('scrolled');
    });

    // --- Load options.json and render form ---
    const OPTIONS_URL = 'options.json';
    const optionsContainer = document.getElementById('options-container');
    const summaryList = document.getElementById('summary-list');
    const partsCostEl = document.getElementById('parts-cost');
    const laborCostEl = document.getElementById('labor-cost');
    const totalCostEl = document.getElementById('total-cost');
    const emailPreviewEl = document.getElementById('email-preview');

    const PARTS_PRICE = 15;
    const LABOR_PRICE = 40;

    let OPTIONS = {}; // loaded
    let selections = {}; // key -> selected items (array or single)

    function renderOptions(data){
      OPTIONS = data;
      optionsContainer.innerHTML = '';
      for(const cat of Object.keys(data)){
        const block = document.createElement('div');
        block.className = 'option-block';
        const title = document.createElement('h4');
        title.textContent = cat;
        block.appendChild(title);

        const items = data[cat];
        // If category has selectAll property in JSON (or 'select' field) we'll render accordingly
        // For categories with "selectAll: true" use checkboxes, otherwise single select dropdown
        const isMulti = !!(data.meta && data.meta.multi && data.meta.multi.includes(cat)) || items.selectAll === true || items.type === 'multi';

        if(isMulti){
          // render checkboxes (select multiple)
          const grid = document.createElement('div');
          grid.className = 'options-grid';
          items.forEach((opt, idx) => {
            const id = `opt-${cat}-${idx}`;
            const wrapper = document.createElement('label');
            wrapper.className = 'checkbox-label';
            wrapper.innerHTML = `
              <input type="checkbox" data-cat="${cat}" data-idx="${idx}" id="${id}" />
              <span class="check-ui"></span>
              <span class="check-text">${opt.name} <span class="opt-price">${money(opt.price)}</span></span>
            `;
            grid.appendChild(wrapper);
          });
          block.appendChild(grid);
        } else {
          // single-select dropdown
          const select = document.createElement('select');
          select.dataset.cat = cat;
          const defaultOpt = document.createElement('option');
          defaultOpt.value = '';
          defaultOpt.textContent = '-- choose --';
          select.appendChild(defaultOpt);
          items.forEach((opt, idx) => {
            const o = document.createElement('option');
            o.value = idx;
            o.textContent = `${opt.name} (${money(opt.price)})`;
            select.appendChild(o);
          });
          block.appendChild(select);
        }

        optionsContainer.appendChild(block);
      }

      // Attach events
      optionsContainer.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        cb.addEventListener('change', onOptionChange);
      });
      optionsContainer.querySelectorAll('select').forEach(sel => {
        sel.addEventListener('change', onOptionChange);
      });

      // init selections
      buildSummary();
    }

    function onOptionChange(e){
      const el = e.target;
      const cat = el.dataset.cat;
      if(el.type === 'checkbox'){
        const idx = Number(el.dataset.idx);
        selections[cat] = selections[cat] || [];
        if(el.checked){
          selections[cat].push(idx);
        } else {
          selections[cat] = selections[cat].filter(i => i !== idx);
        }
      } else if(el.tagName.toLowerCase() === 'select'){
        const idx = el.value === '' ? null : Number(el.value);
        selections[cat] = idx === null ? null : idx;
      }
      buildSummary();
    }

    function buildSummary(){
      // produce summary list & calculate totals
      const lines = [];
      let subtotal = 0;
      for(const cat of Object.keys(OPTIONS)){
        const items = OPTIONS[cat];
        const choice = selections[cat];
        if(Array.isArray(choice) && choice.length){
          choice.forEach(i => {
            const it = items[i];
            if(!it) return;
            lines.push(`${cat}: ${it.name} ${money(it.price)}`);
            subtotal += Number(it.price) || 0;
          });
        } else if(typeof choice === 'number'){
          const it = items[choice];
          if(it){
            lines.push(`${cat}: ${it.name} ${money(it.price)}`);
            subtotal += Number(it.price) || 0;
          }
        }
      }

      // Parts & labor
      subtotal += PARTS_PRICE + LABOR_PRICE;
      partsCostEl.textContent = money(PARTS_PRICE);
      laborCostEl.textContent = money(LABOR_PRICE);
      totalCostEl.textContent = money(subtotal);

      summaryList.innerHTML = lines.length ? '<ul>' + lines.map(l=>`<li>${l}</li>`).join('') + '</ul>' : '<em>No options selected.</em>';

      buildEmailPreview(lines, subtotal);
    }

    // Email builder
    const toEmailEl = document.getElementById('to-email');
    const fromEmailEl = document.getElementById('from-email');
    const fromPhoneEl = document.getElementById('from-phone');
    const notesEl = document.getElementById('extra-notes');
    const copyBtn = document.getElementById('copy-email');
    const openMailBtn = document.getElementById('open-mail');

    function buildEmailPreview(lines, subtotal){
      const now = new Date().toLocaleString();
      const userEmail = fromEmailEl.value || '[your email]';
      const userPhone = fromPhoneEl.value || '[phone]';
      const lead = 'Lead time: up to a month.';
      const bodyLines = [
        `Hello Pennbrenn team,`,
        ``,
        `I'd like a quote for a custom Penncamm.`,
        ``,
        `Selected options:`,
        ...(lines.length ? lines : ['(none)']),
        ``,
        `Parts: ${money(PARTS_PRICE)}`,
        `Labor: ${money(LABOR_PRICE)}`,
        `Total estimate: ${money(subtotal)}`,
        ``,
        `Contact email: ${userEmail}`,
        `Contact phone: ${userPhone}`,
        ``,
        `Notes / questions: ${notesEl.value || '(none)'}`,
        ``,
        `${lead}`,
        ``,
        `Thanks,`,
        `${userEmail}`,
        `Sent: ${now}`
      ];
      emailPreviewEl.value = bodyLines.join('\n');
    }

    // actions
    copyBtn.addEventListener('click', async () => {
      try{
        await navigator.clipboard.writeText(emailPreviewEl.value);
        copyBtn.textContent = 'Copied!';
        setTimeout(()=>copyBtn.textContent = 'Copy email', 1500);
      }catch(e){
        alert('Copy failed — please select and copy manually.');
      }
    });

    openMailBtn.addEventListener('click', () => {
      const to = encodeURIComponent(toEmailEl.value || 'cam@pennbrenn.com');
      const subj = encodeURIComponent('Penncamm Quote Request');
      const body = encodeURIComponent(emailPreviewEl.value);
      window.location.href = `mailto:${to}?subject=${subj}&body=${body}`;
    });

    // Rebuild preview when user edits contact/notes
    [fromEmailEl, fromPhoneEl, notesEl].forEach(el => {
      el.addEventListener('input', () => buildSummary());
    });

    // fetch options.json
    fetch(OPTIONS_URL).then(r => r.ok ? r.json() : null).then(json => {
      if(json) {
        renderOptions(json);
      } else throw new Error('No options.json');
    }).catch(err => {
      // fallback: generate a small internal options set so site still works even if you didn't upload JSON
      console.warn('Failed to load options.json — using fallback defaults', err);
      const fallback = {
        "Wrap": [
          {"name":"Real Leather - Tan","price":50},
          {"name":"Real Leather - Black","price":50},
          {"name":"Foam - Black","price":15},
          {"name":"Metal - Steel","price":80}
        ],
        "Color fade": [
          {"name":"Clear","price":0},
          {"name":"Fade to Accent","price":10}
        ],
        "Storage": [
          {"name":"None","price":0},
          {"name":"16gb (~1h|200photos)","price":5},
          {"name":"32gb (~3h)","price":10},
          {"name":"64gb (~6h)","price":18},
          {"name":"128gb (~12h)","price":30},
          {"name":"256gb (~32h)","price":50}
        ],
        "Lens": [
          {"name":"Basic","price":0},
          {"name":"Macro","price":25},
          {"name":"Fisheye","price":40},
          {"name":"Zoom (>10x)","price":80}
        ],
        "Charger": [
          {"name":"None (Use own)","price":0},
          {"name":"USB-C","price":8}
        ],
        "Battery": [
          {"name":"2000mah (>6h)","price":20},
          {"name":"380mah (>3h)","price":10}
        ]
      };
      // Mark some categories multi-select (Lens)
      fallback.meta = { multi: ["Lens"] };
      renderOptions(fallback);
    });

    // ensure email preview updates when data loads / changes
    setTimeout(buildSummary, 500);
  </script>
</body>
</html>
